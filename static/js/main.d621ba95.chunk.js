(this["webpackJsonpmy-chat-app"]=this["webpackJsonpmy-chat-app"]||[]).push([[0],{51:function(e,t,a){},52:function(e,t,a){},57:function(e,t,a){},58:function(e,t,a){},59:function(e,t,a){},60:function(e,t,a){},61:function(e,t,a){},62:function(e,t,a){},63:function(e,t,a){},64:function(e,t,a){},65:function(e,t,a){},66:function(e,t,a){},67:function(e,t,a){},68:function(e,t,a){"use strict";a.r(t);var n=a(2),s=a(3),r=a.n(s),c=a(30),i=a.n(c),o=a(19),u=a(11),l=a(27),h=a(41),p=a(5);var j=function(e,t){switch(t.type){case"USER_SIGN_IN":return Object(p.a)(Object(p.a)({},e),{},{user:Object(p.a)(Object(p.a)({},t.payload),{},{authenticated:!0})});case"USER_SIGN_OUT":return Object(p.a)(Object(p.a)({},e),{},{user:Object(p.a)(Object(p.a)({},e.user),{},{authenticated:!1})});case"IS_LOADING":return Object(p.a)(Object(p.a)({},e),{},{app:Object(p.a)(Object(p.a)({},e.app),{},{isLoading:t.payload})});case"SHOW_ERROR":return Object(p.a)(Object(p.a)({},e),{},{app:Object(p.a)(Object(p.a)({},e.app),{},{error:t.payload})});case"HIDE_ERROR":return Object(p.a)(Object(p.a)({},e),{},{app:Object(p.a)(Object(p.a)({},e.app),{},{error:!1})});default:return e}},d=Object(l.d)(j,{user:{name:"",id:"",avatar:"",authenticated:!1},app:{isLoading:!1,error:null}},Object(l.c)(Object(l.a)(h.a),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__())),b=(a(51),a(14)),m=a(15),O=a(17),g=a(16),f=(a(52),a(13)),v=a.n(f),x=a(23),_=a(32);_.a.initializeApp({apiKey:"AIzaSyAIaVNyHJGV-vngdDs8r2BAxnsWE2CTswc",authDomain:"my-chat-9290d.firebaseapp.com",projectId:"my-chat-9290d",storageBucket:"my-chat-9290d.appspot.com",messagingSenderId:"159023475897",appId:"1:159023475897:web:b215b7d2a44c5a45d13f68"});var y=_.a.database(),N=_.a.auth;function w(){try{var e=N().currentUser,t={};if(e)return e.providerData.forEach((function(e){t={userId:e.uid,name:e.displayName,email:e.email,avatar:e.photoURL}})),t}catch(a){throw new Error("error getting user info")}}function S(e){return{type:"USER_SIGN_IN",payload:e}}function I(){return N().signOut(),{type:"USER_SIGN_OUT"}}function k(e){return{type:"SHOW_ERROR",payload:e.message}}function E(e){var t=Object(u.d)((function(e){return e.user})),a=Object(u.c)();return r.a.useEffect((function(){a(function(){var e=Object(x.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w();case 3:(a=e.sent)&&t(S(a)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t(k(e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}())}),[t.authenticated,a]),Object(n.jsx)(n.Fragment,{children:t.authenticated?Object(n.jsxs)("div",{className:"user-info",children:[Object(n.jsxs)("h3",{className:"user-info__name",children:[t.name,Object(n.jsx)("span",{className:"user-info__email",children:t.email})]}),Object(n.jsx)("div",{className:"user-info__border",children:Object(n.jsx)("div",{className:"user-info__avatar",style:{backgroundImage:"url(".concat(t.avatar,")")}})}),Object(n.jsx)("button",{className:"user-info__button",onClick:function(){return a(I())},children:"Sign out"})]}):""})}var C=a(10),M=a(42);function R(e){e.component;var t=Object(M.a)(e,["component"]),a=Object(u.d)((function(e){return e.user.authenticated}));return Object(n.jsx)(C.b,{children:function(){return!0===a?t.children:Object(n.jsx)(C.a,{to:"/signin"})}})}a(57);var D=function(e){Object(O.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(b.a)(this,a),(n=t.call(this,e)).dateFormate=function(){return new Date(n.props.timestamp).toTimeString().split(" ")[0]},n.state={},n}return Object(m.a)(a,[{key:"deleteMessage",value:function(){var e=Object(x.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{y.ref("chats/"+this.props.messageKey).remove()}catch(t){this.setState({error:t})}case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{className:"chat-message",children:[Object(n.jsxs)("div",{className:this.props.isYourMessage?"chat-user_your-message":"chat-user",children:[Object(n.jsx)("div",{className:"chat-user__avatar",style:{backgroundImage:"url(".concat(this.props.avatar,")")}}),Object(n.jsx)("p",{className:"chat-user__name",children:this.props.name}),Object(n.jsx)("p",{className:"chat-message__time",children:this.dateFormate()})]}),Object(n.jsx)("p",{className:this.props.isYourMessage?"chat-message__content chat-message__content_your-message":"chat-message__content",children:this.props.message}),this.props.isYourMessage?Object(n.jsx)("button",{className:"chat-message__button-delete",onClick:function(){return e.deleteMessage()}}):""]})}}]),a}(s.Component),L=(a(58),function(e){Object(O.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(b.a)(this,a),(n=t.call(this,e)).sendMessage=function(e){if(e.preventDefault(),n.state.inputMessage.length>0&&n.state.inputMessage.length<60)try{y.ref("chats").push({avatar:n.props.user.avatar,message:n.state.inputMessage,name:n.props.user.name,timestamp:Date.now(),userId:n.props.user.userId}),n.setState(Object(p.a)(Object(p.a)({},n.state),{},{inputMessage:""}))}catch(t){n.setState(Object(p.a)(Object(p.a)({},n.state),{},{errorMessage:t,inputMessage:"",showError:!0}))}else e.target.querySelector("input").blur(),0===n.state.inputMessage.length&&n.setState(Object(p.a)(Object(p.a)({},n.state),{},{errorMessage:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c",showError:!0})),n.state.inputMessage.length>60&&n.setState(Object(p.a)(Object(p.a)({},n.state),{},{errorMessage:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0431\u043e\u043b\u0435\u0435 60 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432",inputMessage:"",showError:!0}))},n.errorMessageHandler=function(e){n.setState(Object(p.a)(Object(p.a)({},n.state),{},{showError:!1}))},n.inputChangeHandler=function(e){n.setState(Object(p.a)(Object(p.a)({},n.state),{},{inputMessage:e.target.value}))},n.state={inputMessage:"",errorMessage:null,showError:!1},n}return Object(m.a)(a,[{key:"render",value:function(){var e=this;return Object(n.jsx)("div",{className:"add-message",children:Object(n.jsxs)("form",{className:"form-add-message",onSubmit:function(t){return e.sendMessage(t)},children:[Object(n.jsx)("input",{className:"form-add-message__input",value:this.state.inputMessage,onChange:function(t){return e.inputChangeHandler(t)},onFocus:function(t){return e.errorMessageHandler(t)},placeholder:"\u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435..."}),Object(n.jsx)("button",{className:"form-add-message__button",type:"submit"}),this.state.showError?Object(n.jsx)("span",{className:"form-add-message__error",children:this.state.errorMessage}):""]})})}}]),a}(s.Component)),U=Object(u.b)((function(e){return{user:e.user}}),null)(L);a(59),a(60);var A=function(){return Object(n.jsx)("section",{className:"preloader",children:Object(n.jsx)("i",{className:"circle-preloader"})})},H=function(e){Object(O.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(b.a)(this,a),(n=t.call(this,e)).state={chats:[],msgAdded:!0},n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){var e=Object(x.a)(v.a.mark((function e(){var t=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.setIsLoading(!0);try{y.ref("chats").on("value",(function(e){var a=[];e.forEach((function(e){a.push(Object(p.a)(Object(p.a)({},e.val()),{},{key:e.key}))})),t.setState(Object(p.a)(Object(p.a)({},t.state),{},{msgAdded:a.length>t.state.chats.length})),t.setState({chats:a}),t.props.setIsLoading(!1)}))}catch(a){this.props.showError(a),this.props.setIsLoading(!1)}case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){this.state.msgAdded&&window.scrollTo({top:document.body.scrollHeight,left:0,behavior:"smooth"})}},{key:"render",value:function(){var e=this;return Object(n.jsx)(n.Fragment,{children:Object(n.jsx)("div",{className:"chat",children:this.props.isLoading?Object(n.jsx)(A,{}):Object(n.jsxs)(n.Fragment,{children:[this.state.chats.map((function(t){return Object(n.jsx)(D,{avatar:t.avatar,name:t.name,message:t.message,timestamp:t.timestamp,messageKey:t.key,isYourMessage:t.userId===e.props.userId},t.key)})),Object(n.jsx)(U,{})]})})})}}]),a}(s.Component),T={setIsLoading:function(e){return{type:"IS_LOADING",payload:e}},showError:k},F=Object(u.b)((function(e){return{userId:e.user.userId,isLoading:e.app.isLoading}}),T)(H),G=a(26),W=(a(61),function(e){Object(O.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(b.a)(this,a),(n=t.call(this,e)).state={email:"",password:"",name:"",avatar:"",error:null},n}return Object(m.a)(a,[{key:"handleInputChange",value:function(e){this.setState(Object(G.a)({},e.target.name,e.target.value))}},{key:"handleSubmit",value:function(){var e=Object(x.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,s=this.state.email,r=this.state.password,N().createUserWithEmailAndPassword(s,r);case 4:return e.next=6,a=this.state.name,n=this.state.avatar,N().currentUser.updateProfile({displayName:a,photoURL:n});case 6:this.props.history.push("/signin"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),this.setState({error:e.t0.message});case 12:case"end":return e.stop()}var a,n,s,r}),e,this,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(n.jsx)("div",{className:"center-element",children:Object(n.jsxs)("form",{className:"sign-up",onSubmit:function(t){return e.handleSubmit(t)},autoComplete:"off",children:[Object(n.jsx)("h1",{children:"Sign Up"}),Object(n.jsx)("div",{children:Object(n.jsx)("input",{placeholder:"Email",name:"email",type:"email",onChange:function(t){return e.handleInputChange(t)},value:this.state.email})}),Object(n.jsx)("div",{children:Object(n.jsx)("input",{placeholder:"Password",name:"password",onChange:function(t){return e.handleInputChange(t)},value:this.state.password,type:"password"})}),Object(n.jsx)("div",{children:Object(n.jsx)("input",{placeholder:"Name",name:"name",onChange:function(t){return e.handleInputChange(t)},value:this.state.name,type:"text"})}),Object(n.jsx)("div",{children:Object(n.jsx)("input",{placeholder:"Avatar URL",name:"avatar",onChange:function(t){return e.handleInputChange(t)},value:this.state.avatar,type:"url"})}),this.state.error?Object(n.jsx)("p",{className:"sign-up__error",children:this.state.error}):null,Object(n.jsx)("button",{type:"submit",className:"sign-up__button",children:"Sign up"}),Object(n.jsx)(o.b,{to:"/signin",className:"home__link",children:"log in"})]})})}}]),a}(s.Component)),P=Object(C.g)(W),V=(a(62),function(e){Object(O.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(b.a)(this,a),(n=t.call(this,e)).state={email:"",password:"",error:null},n}return Object(m.a)(a,[{key:"handleInputChange",value:function(e){this.setState(Object(G.a)({},e.target.name,e.target.value))}},{key:"handleSubmit",value:function(){var e=Object(x.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,n=this.state.email,s=this.state.password,N().signInWithEmailAndPassword(n,s);case 4:a=e.sent,this.props.userSignIn(a),this.props.history.push("/chat"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),this.setState({error:e.t0.message});case 12:case"end":return e.stop()}var n,s}),e,this,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(n.jsx)("div",{className:"center-element",children:Object(n.jsxs)("form",{className:"sign-in",onSubmit:function(t){return e.handleSubmit(t)},autoComplete:"off",children:[Object(n.jsx)("h1",{children:"Sign in"}),Object(n.jsx)("div",{children:Object(n.jsx)("input",{placeholder:"Email",name:"email",type:"email",onChange:function(t){return e.handleInputChange(t)},value:this.state.email})}),Object(n.jsx)("div",{children:Object(n.jsx)("input",{placeholder:"Password",name:"password",onChange:function(t){return e.handleInputChange(t)},value:this.state.password,type:"password"})}),this.state.error?Object(n.jsx)("p",{className:"sign-in__error",children:this.state.error}):null,Object(n.jsx)("button",{type:"submit",className:"sign-in__button",children:"Sign in"}),Object(n.jsx)(o.b,{to:"/signup",className:"home__link",children:"register"})]})})}}]),a}(s.Component)),X={userSignIn:S},Y=Object(C.g)(Object(u.b)(null,X)(V)),B=(a(63),function(e){Object(O.a)(a,e);var t=Object(g.a)(a);function a(){return Object(b.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){return Object(n.jsxs)("div",{className:"home center-element",children:[Object(n.jsx)("h3",{className:"home__title",children:"Welcome to My Chat App "}),Object(n.jsxs)("p",{className:"home__text",children:["To begin, please, \xa0",Object(n.jsx)(o.b,{to:"/signup",className:"home__link",children:"register"})]}),Object(n.jsxs)("p",{className:"home__text",children:["or\xa0",Object(n.jsx)(o.b,{to:"/signin",className:"home__link",children:"log in"}),"\xa0if you already have an account"]})]})}}]),a}(s.Component)),J=(a(64),a.p+"static/media/send.c86bd309.png");function K(){return Object(n.jsx)(n.Fragment,{children:Object(n.jsxs)("div",{className:"header",children:[Object(n.jsx)("img",{className:"header-logo",src:J,alt:"\u043b\u043e\u0433\u043e\u0442\u0438\u043f my chat app"}),Object(n.jsx)("h1",{className:"header-title",children:"My Chat App"})]})})}a(65),a(66),a(67);function z(e){var t=Object(u.d)((function(e){return e.app.error})),a=Object(u.c)();return Object(n.jsx)(n.Fragment,{children:t?Object(n.jsx)("div",{className:"error-popup__wrapper",children:Object(n.jsxs)("div",{className:"error-popup",children:[Object(n.jsxs)("p",{children:["An error occured: ",Object(n.jsx)("br",{}),t]}),Object(n.jsx)("button",{className:"error-popup__button-close",onClick:function(){return a({type:"HIDE_ERROR"})}})]})}):""})}var q=function(e){Object(O.a)(a,e);var t=Object(g.a)(a);function a(){return Object(b.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(K,{}),Object(n.jsx)(z,{}),Object(n.jsx)("div",{className:"wrapper",children:Object(n.jsx)(o.a,{children:Object(n.jsxs)(C.d,{children:[Object(n.jsx)(C.b,{exact:!0,path:"/",component:B}),Object(n.jsxs)(R,{path:"/chat",children:[Object(n.jsx)(E,{}),Object(n.jsx)(F,{})]}),Object(n.jsx)(C.b,{exact:!0,path:"/signin",children:Object(n.jsx)(Y,{})}),Object(n.jsx)(C.b,{exact:!0,path:"/signup",children:Object(n.jsx)(P,{})}),Object(n.jsx)(C.b,{children:this.props.authenticated?Object(n.jsx)(C.a,{to:"/chat"}):Object(n.jsx)(C.a,{to:"/signin"})})]})})})]})}}]),a}(s.Component),Q=Object(u.b)((function(e){return{authenticated:e.user.authenticated,error:e.app.error}}),null)(q);i.a.render(Object(n.jsx)(u.a,{store:d,children:Object(n.jsx)(o.a,{children:Object(n.jsx)(Q,{})})}),document.getElementById("root"))}},[[68,1,2]]]);
//# sourceMappingURL=main.d621ba95.chunk.js.map